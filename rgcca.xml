<tool id="multiOmics_Toolbox" name="multiOmics_Toolbox" version="1.0">

    <description>performs multiblock data analysis of several sets of variables (blocks) observed on the same group of individuals.</description>

    <macros>
        <import>macro.xml</import>
    </macros>

    <command ><![CDATA[
        #set $data_paths = $block_1.file_name
        #set $data_names = $block_1.name
        #for $i, $s in enumerate( $dataset )
            #set $data_paths += ',' + $s.block_n.file_name
            #set $data_names += ',' + $s.block_n.name
        #end for
        Rscript $__tool_directory__/R/launcher.R
             -d "${$data_paths}"
             --names "${$data_names}"
             -w $__tool_directory__
             --output1 $samples_space --output2 $variables_space --output3 $best_biomarkers
             #if $parse.advanced
                --separator $parse.separator
             #end if
             #if $analyse.advanced
                -g $analyse.scheme
                #if $analyse.connection.bool
                    -c $analyse.connection.file
                #end if
                #if $analyse.response.bool
                    -r $analyse.response.file
                #end if
             #end if
    ]]></command>

    <inputs>
    <param name="block_1" type="data" format="tsv,tabular,txt,csv" label="Dataset"
           help="File containing a matrix with the samples in lines (should be labelled) and variables in columns (should have an header)." />
    <repeat name="dataset" title="New dataset"
            help="Additional dataset with a different structure than the first one. Each dataset will be analysed separately.
            Expected format is a file containing a matrix with the samples in lines (should be labelled) and variables in columns
            (should have an header)" >
        <param name="block_n" type="data" format="tsv,tabular,txt,csv" label="Dataset" />
    </repeat>

        <conditional name="parse">
            <param name="advanced" type="boolean" label="Customize parsing of the fingerprint dataset parameters (by default, on tabulated file)"/>
            <when value="true">
                <param name="separator" type="select" display="radio" label="Column separator" help="Character used to separate the column in the dataset (by default: tabulation). ">
                    <option value="1" selected="true">Tabulation</option>
                    <option value="2">Semicolon</option>
                </param>
            </when>
        </conditional>

        <conditional name="analyse">
            <param name="advanced" type="boolean" label="Customize analysis settings"/>
            <when value="true">
                <conditional name="connection">
                    <param name="bool" type="boolean"
                           label="Modifiy the design matrix (describes the relationships between blocks)" />
                    <when value="true">
                        <param name="file" type="data" format="tsv,tabular,txt,csv" label="Design matrix"
                               help="The design matrix is a symmetric matrix of non-negative elements describing the network of connections
                                between blocks that the user wants to take into account. Its dimension should be (NB_BLOCKS + 1) * (NB_BLOCKS + 1).
                                + 1 corresponds for the use of a supplementary block (the 'superblock'), a concatenation of all the blocks helpful to
                                interpret the results. By default, the connection matrix is build with 1 values for the last line (and column) except
                                for the diagonal (i.e., the superblock is fully connected with the other blocks) and 0 values for the other cells
                                (the blocks are not connected together). To go further than his null hypothesis, a priori information could be used
                                 to tune the matrix (e.g., add 1 value for a connection between two block)." />
                    </when>
                </conditional>
                <conditional name="response">
                    <param name="bool" type="boolean" label="Color the samples according to their group of response"/>
                    <when value="true">
                        <param name="file" type="data" format="tsv,tabular,txt,csv" label="Groups of response"
                               help="File containing an only column of a qualitative variable." />
                    </when>
                </conditional>
                <param name="scheme" type="select" label="Scheme function" help="Choices of scheme function are the identity (horst scheme, leading
                to maximizing the sum of covariances between block components), the absolute value (centroid scheme, yielding maximization of the sum
                of the absolute values of the covariances), the square function (factorial scheme, thereby maximizing the sum of squared covariances),
                or, more generally, for any even integer m,g(x)=x^m (m-scheme, maximizing the power of m of the sum ,of covariances). ">
                    <option value="1">Horst : f(x) </option>
                    <option value="2" selected="true">Factorial : f(x)^2 </option>
                    <option value="3">Centroid : f|x| </option>
                    <option value="4">Other: f(x)^4</option>
                </param>
            </when>
        </conditional>

    </inputs>

    <outputs>
        <data name="samples_space" label="samples_space.pdf" format="pdf" />
        <data name="variables_space" label="variables_space.pdf" format="pdf" />
        <data name="best_biomarkers"  label="best_biomarkers.pdf" format="pdf" />
    </outputs>
<help>

==================================
ABOUT
==================================


**Authors:**
Arthur TENENHAUS, Vincent GUILLEMOT, Etienne CAMENEN


**Contact:**
arthur.tenenhaus@l2s.centralesupelec.fr


**R package:**
The RGCCA package is available from the CRAN repository (https://cran.r-project.org/web/packages/RGCCA).

---------------------------------------------------

==================================
MULTI-OMICS TOOLBOX
==================================

**Description**

We consider J data matrices X1 ,..., XJ.  Each n Ã— pj data matrix Xj = [ xj1, ..., xjpj ] is called a block and represents a set
of pj variables observed on n individuals. The number and the nature of the variables may differ from one block to another,
but the individuals must be the same across blocks. We assume that all variables are centered. The objective of RGCCA is to find,
for each block, a weighted composite of variables (called block component) yj = Xjaj, j = 1 ,..., J (where a j is a column-vector with pj
elements) summarizing the relevant information between and within the blocks. The block components are obtained such that (i) block
components explain well their own block and/or (ii) block components that are assumed to be connected are highly correlated.
As a component-based method, RGCCA can provide users with graphical representations to visualize the sources
of variability within blocks and the amount of correlation between blocks.

**Input file**

- *blocks* (.tsv, .csv or .txt) : tabulated files containing variables to analyse together. The samples should be in lines and labelled and variables in columns with an header.
- *connection* (.tsv, .csv or .txt) : tabulated files without header, containing a symmetric matrix with either 0 or 1 for a connection between each blocks.
- *response* (.tsv, .csv or .txt) : an only column of a qualitative variable.

**Working example**

    | From Russett data (RGCCA package) : https://gitlab.icm-institute.org/etienne.camenen/rgcca_galaxy/tree/feature/proofConcept/data
    | Use *agriculture.tsv* as dataset. Add *industry.tsv* and *politic.tsv* as new dataset. Eventually, use *response.tsv* as group of response in analysis custom settings.

**Output files**

- *variables_space* (.pdf) : samples projected in a space composed by the first two component of the analysis (with the percent of explained variance). By selecting a response, samples are colored according to this criterion.
- *samples_space* (.pdf) : circle of correlation of variables with the first two component of the analysis (with the percent of  explained variance). The dotted circle corresponds to a 0.5 correlation and the full one corresponds to a 1 correlation.
- *best_biomarkers* (.pdf) : 100 best biomarkers for a set of blocks according to the weight of these variables in the analysis (eigen value for PCA, canonical variable for CCA, component for PLS and RGCCA).

<![CDATA[

@VARIABLES_IMG@
@SAMPLES_IMG@
@BIOMARKERS_IMG@

]]>

</help>

    <citations>
        <citation type="doi">10.1007/s11336-017-9573-x</citation>
        <citation type="doi">10.1007/s11336-011-9206-8</citation>
    </citations>

</tool>